name: Discord Webhook Test

on:
  workflow_dispatch:  # This allows manual triggering from the GitHub UI

jobs:
  simulate-task:
    runs-on: ubuntu-latest
    steps:
      - name: Simulate Return
        run: exit 0

  send-discord-message:
    needs: simulate-task
    if: always()
    runs-on: ubuntu-latest
    steps:
      - name: Post Discord Webhook
        uses: tsickert/discord-webhook@v6.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK_URL }}
          username: GopherMaps Data
          avatar-url: https://github.com/ryan-roche/gophermaps-data/blob/41aff9bce9af2257665f8393c372d84f7fc5826a/webhook-icons/gw-data.png?raw=true
          embed-title: ${{ needs.simulate-task.result == 'success' && 'Job Succeeded' || 'Job Failed' }}
          embed-url: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
          embed-description: ${{ needs.simulate-task.result == 'success' && 'Manifest generated successfully' || 'TODO add error logs' }}
          embed-author-name: "Generate manifest.json"
          embed-author-icon-url: "https://github.com/github.png"
          embed-author-url: "https://github.com/ryan-roche/gophermaps-data/actions/workflows/manifest-generator.yml"
          embed-thumbnail-url: "https://github.com/actions-user.png"
          embed-color: ${{ needs.simulate-task.result == 'success' && 4029719 || 12845056 }}
